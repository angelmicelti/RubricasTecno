<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Evaluación Multi-Alumno</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --success: #27ae60;
      --warning: #f39c12;
      --danger: #e74c3c;
      --light: #ecf0f1;
      --dark: #34495e;
      --gray: #95a5a6;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
      color: #333;
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 25px;
      padding: 25px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, #3498db, #2ecc71, #e74c3c);
    }
    
    h1 {
      color: var(--primary);
      margin-bottom: 10px;
      font-size: 2.5rem;
      font-weight: 700;
    }
    
    .subtitle {
      color: #555;
      font-size: 1.2rem;
      max-width: 800px;
      margin: 0 auto;
      font-weight: 300;
    }
    
    .config-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 1000px) {
      .config-section {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 768px) {
      .config-section {
        gap: 15px;
      }
    }
    
    .config-panel {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      padding: 25px;
    }
    
    @media (max-width: 768px) {
      .config-panel {
        padding: 20px;
      }
    }
    
    .panel-title {
      color: var(--primary);
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--secondary);
      font-size: 1.6rem;
      display: flex;
      align-items: center;
      cursor: pointer;
      user-select: none;
      transition: all 0.3s ease;
    }
    
    .panel-title:hover {
      color: var(--secondary);
    }
    
    .panel-title i {
      margin-right: 15px;
      color: var(--secondary);
    }
    
    .panel-title .toggle-icon {
      margin-left: auto;
      transition: transform 0.3s ease;
    }
    
    .panel-title.collapsed .toggle-icon {
      transform: rotate(-90deg);
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark);
    }
    
    input[type="number"], 
    input[type="text"],
    select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s;
    }
    
    input:focus, select:focus {
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
      outline: none;
    }
    
    .btn {
      background: linear-gradient(135deg, var(--secondary), #1a6ca9);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    .btn i {
      margin-right: 10px;
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 20px rgba(52, 152, 219, 0.4);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-success {
      background: linear-gradient(135deg, var(--success), #1e8449);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, var(--warning), #d35400);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #c0392b);
    }
    
    .btn-block {
      width: 100%;
      margin-top: 15px;
    }
    
    .controls {
      display: flex;
      flex-wrap: wrap;
      margin: 20px 0;
      gap: 10px;
    }
    
    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
        margin-right: 0;
      }
    }
    
    /* Botones apilados verticalmente en la sección Acciones */
    .controls-vertical {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .controls-vertical .btn {
      width: 100%;
      margin-right: 0;
    }
    
    .tareas-section {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      padding: 25px;
      margin-bottom: 20px;
    }
    
    .tareas-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 768px) {
      .tareas-container {
        grid-template-columns: 1fr;
      }
    }
    
    .tarea-item {
      display: flex;
      flex-direction: column;
      padding: 15px;
      border: 1px solid #e0e6ed;
      border-radius: 12px;
      background: linear-gradient(to bottom, #ffffff, #f8f9fa);
      transition: all 0.3s ease;
      position: relative;
    }
    
    .tarea-item:hover {
      border-color: var(--secondary);
      box-shadow: 0 10px 25px rgba(52, 152, 219, 0.2);
      transform: translateY(-3px);
    }
    
    .tarea-header {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .tarea-header label {
      flex: 1;
      font-weight: 600;
      cursor: pointer;
      color: var(--primary);
      font-size: 1.1rem;
      margin-right: 50px; /* Espacio adicional entre título y puntuación */
    }
    
    .valor-input {
      width: 30px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 8px;
      text-align: center;
      font-weight: 600;
      color: var(--primary);
    }
    
    .tarea-criteria {
      padding: 10px;
      background-color: #f8fafc;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #555;
      max-height: 150px;
      overflow-y: auto;
    }
    
    .tarea-criteria h4 {
      margin: 8px 0;
      color: var(--primary);
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .tarea-criteria h4 i {
      cursor: pointer;
      transition: transform 0.3s;
    }
    
    .tarea-criteria h4 i.rotated {
      transform: rotate(180deg);
    }
    
    .criterios-list {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 5px;
    }
    
    @media (max-width: 480px) {
      .criterios-list {
        grid-template-columns: 1fr;
      }
    }
    
    .criterio-item {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
      position: relative;
    }
    
    .criterio-item input {
      margin-right: 8px;
    }
    
    .criterio-item label {
      font-size: 0.85rem;
      font-weight: normal;
      cursor: pointer;
      position: relative;
    }
    
    /* Estilos mejorados para tooltips */
    [data-tooltip] {
      position: relative;
      cursor: pointer;
    }
    
    [data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #2c3e50;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.8rem;
      white-space: nowrap;
      z-index: 1000;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      min-width: 200px;
      max-width: 300px;
      text-align: center;
      line-height: 1.4;
    }
    
    [data-tooltip]::before {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(6px);
      border: 6px solid transparent;
      border-top-color: #2c3e50;
      z-index: 1001;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    [data-tooltip]:hover::after,
    [data-tooltip]:hover::before {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    /* Ajuste para tooltips a la izquierda */
    .tooltip-left::after {
      left: 0;
      transform: translateX(0);
    }
    
    .tooltip-left::before {
      left: 10px;
      transform: translateX(0) translateY(6px);
    }
    
    .tooltip-left:hover::after {
      transform: translateX(0) translateY(0);
    }
    
    .tooltip-left:hover::before {
      transform: translateX(0) translateY(0);
    }
    
    /* Ajuste para tooltips a la derecha */
    .tooltip-right::after {
      left: auto;
      right: 0;
      transform: translateX(0);
    }
    
    .tooltip-right::before {
      left: auto;
      right: 10px;
      transform: translateX(0) translateY(6px);
    }
    
    .tooltip-right:hover::after {
      transform: translateX(0) translateY(0);
    }
    
    .tooltip-right:hover::before {
      transform: translateX(0) translateY(0);
    }
    
    .evaluation-section {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      padding: 25px;
      margin-top: 20px;
      display: none;
    }
    
    .table-container {
      overflow-x: auto;
      margin: 20px 0;
      border: 1px solid #e0e6ed;
      border-radius: 12px;
      max-height: 70vh;
      overflow-y: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #fff;
    }
    
    th, td {
      border: 1px solid #e0e6ed;
      padding: 8px;
      text-align: center;
      font-size: 0.9rem;
    }
    
    th {
      background: linear-gradient(135deg, var(--primary), #1c2e40);
      color: white;
      font-weight: 600;
      position: sticky;
      top: 0;
    }
    
    tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    
    tr:hover {
      background-color: #f1f9ff;
    }
    
    .student-score {
      width: 60px;
      padding: 6px;
      border: 1px solid #ddd;
      border-radius: 5px;
      text-align: center;
      font-weight: 600;
      transition: all 0.3s;
      font-size: 0.9rem;
    }
    
    .student-score:focus {
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
      outline: none;
    }
    
    .student-score.invalid {
      border-color: var(--danger);
      background-color: #fee;
      animation: shake 0.5s;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .criteria-cell {
      max-width: 150px;
      word-wrap: break-word;
      text-align: left;
      padding: 8px 10px;
      font-weight: 600;
      color: var(--primary);
      position: relative;
    }
    
    .student-header-cell {
      min-width: 80px;
      max-width: 120px;
      word-wrap: break-word;
      padding: 8px 5px;
      font-size: 0.85rem;
    }
    
    .max-value-cell {
      width: 70px;
      font-weight: 600;
      color: var(--dark);
    }
    
    .results-section {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      padding: 25px;
      margin-top: 20px;
      display: none;
    }
    
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    @media (max-width: 768px) {
      .results-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .student-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      border: 1px solid #e0e6ed;
    }
    
    .student-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .student-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    
    @media (max-width: 480px) {
      .student-header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .student-avg {
        margin-top: 10px;
      }
    }
    
    .student-name {
      font-weight: 700;
      font-size: 1.3rem;
      color: var(--primary);
    }
    
    .student-avg {
      font-weight: 700;
      font-size: 1.5rem;
      background: linear-gradient(135deg, var(--secondary), #1a6ca9);
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
    }
    
    .criteria-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px dashed #eee;
    }
    
    .criteria-name {
      font-weight: 500;
      flex: 1;
      position: relative;
    }
    
    .criteria-score {
      font-weight: 600;
      min-width: 60px;
      text-align: right;
    }
    
    .criteria-group {
      font-weight: 700;
      color: var(--primary);
      background-color: #e1f5fe;
      padding: 8px 15px;
      border-radius: 6px;
      margin: 10px 0;
    }
    
    .text-danger {
      color: var(--danger);
    }
    
    .text-warning {
      color: var(--warning);
    }
    
    .text-success {
      color: var(--success);
    }
    
    .footer {
      text-align: center;
      margin-top: 40px;
      padding: 25px;
      color: #666;
      font-size: 1rem;
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }
    
    .message {
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      text-align: center;
      font-weight: 500;
    }
    
    .message.info {
      background-color: #d1ecf1;
      color: #0c5460;
      border-left: 4px solid var(--secondary);
    }
    
    .hidden {
      display: none;
    }
    
    .nombres-alumnos-section {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      padding: 25px;
      margin-top: 20px;
      display: none;
    }
    
    .alumnos-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    @media (max-width: 768px) {
      .alumnos-container {
        grid-template-columns: 1fr;
      }
    }
    
    .alumno-item {
      display: flex;
      flex-direction: column;
      padding: 15px;
      border: 1px solid #e0e6ed;
      border-radius: 12px;
      background: linear-gradient(to bottom, #ffffff, #f8f9fa);
    }
    
    .alumno-header {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .alumno-header label {
      flex: 1;
      font-weight: 600;
      color: var(--primary);
      font-size: 1.1rem;
    }
    
    .alumno-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease forwards;
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.4); }
      70% { box-shadow: 0 0 0 15px rgba(52, 152, 219, 0); }
      100% { box-shadow: 0 0 0 0 rgba(52, 152, 219, 0); }
    }
    
    /* Estilos para el botón de ayuda */
    .help-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, var(--secondary), #1a6ca9);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      z-index: 1000;
      transition: all 0.3s ease;
    }
    
    .help-button:hover {
      transform: scale(1.1);
      box-shadow: 0 7px 20px rgba(52, 152, 219, 0.4);
    }
    
    /* Estilos para el modal de ayuda */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 20px;
    }
    
    .modal-content {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }
    
    .modal-header {
      padding: 25px 25px 15px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-size: 1.8rem;
      color: var(--primary);
      font-weight: 700;
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--gray);
      transition: color 0.3s;
    }
    
    .close-modal:hover {
      color: var(--danger);
    }
    
    .modal-body {
      padding: 25px;
    }
    
    .help-section {
      margin-bottom: 30px;
    }
    
    .help-section h3 {
      color: var(--primary);
      margin-bottom: 15px;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
    }
    
    .help-section h3 i {
      margin-right: 10px;
      color: var(--secondary);
    }
    
    .help-section p {
      margin-bottom: 15px;
      line-height: 1.6;
    }
    
    .help-section ul {
      padding-left: 20px;
      margin-bottom: 15px;
    }
    
    .help-section li {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    
    .feature-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .feature-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      border-left: 4px solid var(--secondary);
    }
    
    .feature-item h4 {
      color: var(--primary);
      margin-bottom: 8px;
      font-size: 1.1rem;
    }
    
    .feature-item p {
      font-size: 0.9rem;
      color: #555;
      margin: 0;
    }
    
    /* Estilos para secciones colapsables */
    .section-content {
      transition: all 0.3s ease;
      overflow: hidden;
    }
    
    .section-content.collapsed {
      max-height: 0;
      opacity: 0;
      margin-bottom: 0;
      padding: 0;
    }
    
    .section-content.expanded {
      max-height: 5000px; /* Valor suficientemente alto */
      opacity: 1;
    }
    
    /* Estilos responsivos adicionales */
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      header {
        padding: 15px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .subtitle {
        font-size: 1rem;
      }
      
      .config-panel, .tareas-section, .evaluation-section, .results-section, .nombres-alumnos-section {
        padding: 15px;
      }
      
      .panel-title {
        font-size: 1.3rem;
      }
      
      .tarea-item {
        padding: 10px;
      }
      
      .student-card {
        padding: 15px;
      }
      
      .help-button {
        width: 50px;
        height: 50px;
        font-size: 20px;
        bottom: 15px;
        right: 15px;
      }
    }
  </style>
</head>
<body>
  <!-- Botón de ayuda flotante -->
  <div class="help-button" id="help-button">
    <i class="fas fa-question"></i>
  </div>

  <!-- Modal de ayuda -->
  <div class="modal-overlay" id="help-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title"><i class="fas fa-info-circle"></i> Ayuda - Sistema de Evaluación</h2>
        <button class="close-modal" id="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="help-section">
          <h3><i class="fas fa-graduation-cap"></i> ¿Qué es este sistema?</h3>
          <p>El Sistema de Evaluación Multi-Alumno es una herramienta diseñada para facilitar la evaluación de estudiantes en la asignatura de Tecnología de 4º ESO, permitiendo evaluar múltiples criterios y competencias de forma simultánea.</p>
        </div>
        
        <div class="help-section">
          <h3><i class="fas fa-list-ol"></i> Funcionalidades principales</h3>
          <div class="feature-list">
            <div class="feature-item">
              <h4><i class="fas fa-users"></i> Gestión de alumnos</h4>
              <p>Configura el número de estudiantes y sus nombres para la evaluación.</p>
            </div>
            <div class="feature-item">
              <h4><i class="fas fa-tasks"></i> Selección de tareas</h4>
              <p>Elige entre más de 20 tipos de actividades con criterios predefinidos.</p>
            </div>
            <div class="feature-item">
              <h4><i class="fas fa-clipboard-check"></i> Evaluación personalizada</h4>
              <p>Asigna puntuaciones individuales para cada estudiante y tarea.</p>
            </div>
            <div class="feature-item">
              <h4><i class="fas fa-chart-bar"></i> Cálculo automático</h4>
              <p>Calcula promedios por criterio y estudiante automáticamente.</p>
            </div>
            <div class="feature-item">
              <h4><i class="fas fa-file-pdf"></i> Exportación a PDF</h4>
              <p>Genera informes detallados en formato PDF para cada estudiante.</p>
            </div>
            <div class="feature-item">
              <h4><i class="fas fa-file-csv"></i> Exportación de rúbricas</h4>
              <p>Exporta las rúbricas en formato CSV para importar en Google Classroom.</p>
            </div>
            <div class="feature-item">
              <h4><i class="fas fa-file-export"></i> Exportación/Importación</h4>
              <p>Guarda y carga listas de alumnos por clase para reutilizarlas.</p>
            </div>
          </div>
        </div>
        
        <div class="help-section">
          <h3><i class="fas fa-play-circle"></i> Cómo usar el sistema</h3>
          <ol>
            <li><strong>Configuración inicial:</strong> Establece el número de alumnos y el nombre de la actividad.</li>
            <li><strong>Nombres de alumnos:</strong> Introduce los nombres de todos los estudiantes.</li>
            <li><strong>Selección de tareas:</strong> Elige las actividades a evaluar y ajusta sus valores.</li>
            <li><strong>Evaluación:</strong> Asigna puntuaciones a cada estudiante en cada tarea.</li>
            <li><strong>Resultados:</strong> Calcula los resultados para ver los promedios por criterio.</li>
            <li><strong>Exportación:</strong> Genera informes PDF o exporta rúbricas para Classroom.</li>
          </ol>
        </div>
        
        <div class="help-section">
          <h3><i class="fas fa-lightbulb"></i> Consejos útiles</h3>
          <ul>
            <li>Puedes personalizar los criterios de cada tarea marcando/desmarcando las casillas correspondientes.</li>
            <li>Utiliza los tooltips (información emergente) para conocer la descripción de cada criterio.</li>
            <li>Las tareas seleccionadas aparecerán en la tabla de evaluación en el orden en que fueron seleccionadas.</li>
            <li>Los resultados se calculan automáticamente por criterio y se promedian para obtener la nota final.</li>
            <li>Las rúbricas exportadas son compatibles con Google Classroom para una fácil importación.</li>
            <li>Puedes guardar y cargar listas de alumnos para diferentes clases usando las opciones de exportación/importación.</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <header class="fade-in">
      <h1><i class="fas fa-user-graduate"></i> Sistema de Evaluación Multi-Alumno</h1>
      <p class="subtitle">Evalúa a múltiples estudiantes con actividades personalizadas</p>
    </header>
    
    <section class="config-section fade-in">
      <div class="config-panel">
        <h2 class="panel-title"><i class="fas fa-cog"></i> Configuración General</h2>
        
        <div class="form-group">
          <label for="num-alumnos"><i class="fas fa-users"></i> Número de Alumnado</label>
          <input type="number" id="num-alumnos" min="1" max="50" value="5">
        </div>
        
        <div class="form-group">
          <label for="actividad"><i class="fas fa-book"></i> Nombre de la Actividad</label>
          <input type="text" id="actividad" value="Actividad">
        </div>
        
        <div class="form-group">
          <label for="valor-total"><i class="fas fa-star"></i> Valor Total Actividad</label>
          <input type="number" id="valor-total" min="1" value="10">
        </div>
        
        <div class="form-group">
          <label for="nombre-clase"><i class="fas fa-school"></i> Nombre de la Clase</label>
          <input type="text" id="nombre-clase" value="4ESO">
        </div>
        
        <button class="btn btn-success btn-block pulse" id="configurar-alumnos">
          <i class="fas fa-user-plus"></i> Configurar Alumnado
        </button>
      </div>
      
      <div class="config-panel">
        <h2 class="panel-title"><i class="fas fa-tasks"></i> Acciones</h2>
        
        <!-- Botones apilados verticalmente -->
        <div class="controls controls-vertical">
          <button class="btn btn-success" id="generar-evaluacion">
            <i class="fas fa-play"></i> Generar Evaluación
          </button>
          <button class="btn" id="seleccionar-todas">
            <i class="fas fa-check-square"></i> Seleccionar Todas las Tareas
          </button>
          <button class="btn" id="deseleccionar-todas">
            <i class="fas fa-square"></i> Deseleccionar Todas las Tareas
          </button>
        </div>
        
        <div class="message info">
          <i class="fas fa-info-circle"></i> Seleccione las tareas para la evaluación
        </div>
      </div>
    </section>
    
    <section class="nombres-alumnos-section fade-in" id="nombres-alumnos-section">
      <h2 class="panel-title collapsible" id="nombres-alumnos-title">
        <i class="fas fa-user-edit"></i> Nombres del Alumnado
        <i class="fas fa-chevron-down toggle-icon"></i>
      </h2>
      <div class="section-content expanded" id="nombres-alumnos-content">
        <div class="alumnos-container" id="alumnos-container"></div>
        
        <div class="controls">
          <button class="btn btn-success" id="guardar-alumnos">
            <i class="fas fa-save"></i> Guardar Alumnado
          </button>
          <button class="btn" id="exportar-alumnos">
            <i class="fas fa-file-export"></i> Exportar Alumnado
          </button>
          <button class="btn" id="importar-alumnos">
            <i class="fas fa-file-import"></i> Importar Alumnado
          </button>
          <input type="file" id="importar-alumnos-file" accept=".json" style="display: none;">
        </div>
      </div>
    </section>
    
    <section class="tareas-section fade-in">
      <h2 class="panel-title collapsible" id="tareas-title">
        <i class="fas fa-clipboard-list"></i> Selección de Tareas
        <i class="fas fa-chevron-down toggle-icon"></i>
      </h2>
      <div class="section-content expanded" id="tareas-content">
        <div class="controls">
          <button class="btn btn-success" id="exportar-rubricas-csv-tareas">
            <i class="fas fa-file-csv"></i> Exportar Rúbricas a CSV
          </button>
        </div>
        
        <div class="tareas-container" id="selector-tareas"></div>
      </div>
    </section>
    
    <section class="evaluation-section fade-in" id="evaluacion-section">
      <h2 class="panel-title collapsible" id="evaluacion-title">
        <i class="fas fa-clipboard-check"></i> Evaluación del Alumnado
        <i class="fas fa-chevron-down toggle-icon"></i>
      </h2>
      <div class="section-content expanded" id="evaluacion-content">
        <div class="table-container">
          <table id="tabla-evaluacion">
            <thead>
              <tr id="tabla-header"></tr>
            </thead>
            <tbody id="cuerpo-tabla"></tbody>
          </table>
        </div>
        
        <div class="controls">
          <button class="btn btn-warning" id="calcular-resultados">
            <i class="fas fa-calculator"></i> Calcular Resultados
          </button>
          <button class="btn" id="nueva-evaluacion">
            <i class="fas fa-sync-alt"></i> Nueva Evaluación
          </button>
        </div>
      </div>
    </section>
    
    <section class="results-section fade-in" id="resultados-section">
      <h2 class="panel-title collapsible" id="resultados-title">
        <i class="fas fa-chart-bar"></i> Resultados de la Evaluación
        <i class="fas fa-chevron-down toggle-icon"></i>
      </h2>
      <div class="section-content expanded" id="resultados-content">
        <div class="results-grid" id="resumen-alumnos"></div>
        
        <div class="controls">
          <button class="btn btn-danger" id="exportar-pdf">
            <i class="fas fa-file-pdf"></i> Exportar a PDF
          </button>
          <button class="btn btn-success" id="exportar-rubricas-csv">
            <i class="fas fa-file-csv"></i> Exportar Rúbricas a CSV
          </button>
          <button class="btn" id="volver-evaluacion">
            <i class="fas fa-arrow-left"></i> Volver a Evaluación
          </button>
        </div>
      </div>
    </section>
    
    <div class="footer fade-in">
      <p>Sistema de Evaluación Multi-Alumno - Tecnología 4° ESO</p>
      <p>© 2025 Departamento de Tecnología | IES Virgen de Villadiego</p>
    </div>
  </div>

  <script>
    const criterios = [
      "TEC4.1.1", "TEC4.1.2", "TEC4.1.3", "TEC4.2.1", "TEC4.2.2", "TEC4.3.1",
      "TEC4.3.2", "TEC4.4.1", "TEC4.4.2", "TEC4.5.1", "TEC4.6.1", "TEC4.6.2", "TEC4.6.3"
    ];

    const tooltipTextos = {
      "TEC4.1.1": "Idear y planificar soluciones tecnológicas emprendedoras",
      "TEC4.1.2": "Aplicar estrategias colaborativas de gestión de proyectos",
      "TEC4.1.3": "Gestionar proyectos de forma creativa",
      "TEC4.2.1": "Analizar el diseño de productos",
      "TEC4.2.2": "Fabricar productos tecnológicos",
      "TEC4.3.1": "Intercambiar información y trabajar en equipo",
      "TEC4.3.2": "Presentar propuestas tecnológicas",
      "TEC4.4.1": "Diseñar y simular sistemas automáticos",
      "TEC4.4.2": "Integrar aplicaciones como IoT, big data o IA",
      "TEC4.5.1": "Resolver tareas con eficiencia",
      "TEC4.6.1": "Usar la tecnología con sostenibilidad",
      "TEC4.6.2": "Valorar beneficios del ecotransporte",
      "TEC4.6.3": "Valorar proyectos con beneficio social"
    };

    const tareasCriterios = {
      "ANÁLISIS": ["TEC4.2.1", "TEC4.3.1", "TEC4.5.1", "TEC4.6.1", "TEC4.6.2"],
      "ANTEPROYECTO": ["TEC4.1.1", "TEC4.1.2", "TEC4.1.3", "TEC4.2.1", "TEC4.3.1", "TEC4.3.2", "TEC4.4.1", "TEC4.4.2", "TEC4.5.1", "TEC4.6.1", "TEC4.6.2"],
      "CUADERNO": ["TEC4.3.1", "TEC4.3.2"],
      "CUESTIONARIO": ["TEC4.3.1", "TEC4.4.1"],
      "DEBATE": ["TEC4.3.1", "TEC4.3.2", "TEC4.6.3"],
      "DIAGRAMA DE FLUJO": ["TEC4.1.1", "TEC4.1.3", "TEC4.2.1", "TEC4.4.1", "TEC4.4.2", "TEC4.5.1"],
      "DIBUJO TIPO CANVA": ["TEC4.1.1", "TEC4.1.3", "TEC4.2.1", "TEC4.3.1", "TEC4.5.1", "TEC4.6.1"],
      "EXPOSICION ORAL": ["TEC4.3.1", "TEC4.3.2"],
      "HOJA DE CÁLCULO": ["TEC4.4.1", "TEC4.4.2", "TEC4.5.1"],
      "INFORME": ["TEC4.2.1", "TEC4.3.1", "TEC4.4.1", "TEC4.4.2"],
      "LÁMINA DE DIBUJO": ["TEC4.1.1", "TEC4.2.2", "TEC4.3.1"],
      "LIBRECAD": ["TEC4.1.1", "TEC4.2.2", "TEC4.5.1"],
      "LÍNEA DE TIEMPO": ["TEC4.3.1", "TEC4.5.1", "TEC4.6.3"],
      "MAPA CONCEPTUAL": ["TEC4.3.1", "TEC4.3.2", "TEC4.5.1"],
      "MAQUETA": ["TEC4.1.1", "TEC4.1.2", "TEC4.1.3", "TEC4.2.2", "TEC4.4.1", "TEC4.4.2", "TEC4.6.1", "TEC4.6.2"],
      "MEMORIA FINAL": ["TEC4.1.1", "TEC4.2.1", "TEC4.3.1", "TEC4.3.2", "TEC4.4.1", "TEC4.4.2", "TEC4.5.1"],
      "PODCAST / AUDIO": ["TEC4.3.1", "TEC4.3.2", "TEC4.5.1"],
      "PRÁCTICA": ["TEC4.1.2", "TEC4.1.3", "TEC4.2.1", "TEC4.2.2", "TEC4.4.1", "TEC4.6.1", "TEC4.6.2"],
      "PRESENTACIÓN DIGITAL": ["TEC4.3.1", "TEC4.3.2", "TEC4.5.1"],
      "PROGRAMA/APLICACIÓN": ["TEC4.4.1", "TEC4.4.2", "TEC4.5.1"],
      "PRUEBA ESCRITA": ["TEC4.3.1", "TEC4.4.1"],
      "PRUEBA ORAL": ["TEC4.3.1", "TEC4.3.2", "TEC4.4.1"],
      "RESOLUCIÓN DE PROBLEMAS": ["TEC4.1.1", "TEC4.1.2", "TEC4.1.3", "TEC4.2.1", "TEC4.2.2", "TEC4.3.1", "TEC4.4.1"],
      "SIMULACIÓN": ["TEC4.1.1", "TEC4.2.2", "TEC4.4.1", "TEC4.4.2", "TEC4.5.1"],
      "SKETCHUP / TINKERCAD 3D": ["TEC4.1.1", "TEC4.2.2", "TEC4.5.1"],
      "SUPUESTO PRÁCTICO": ["TEC4.1.1", "TEC4.1.2", "TEC4.1.3", "TEC4.2.1", "TEC4.2.2", "TEC4.3.1", "TEC4.4.1"],
      "VIDEO": ["TEC4.1.1", "TEC4.3.1", "TEC4.3.2", "TEC4.5.1"],
      "WIKI": ["TEC4.1.1", "TEC4.3.1", "TEC4.3.2", "TEC4.5.1"]
    };

    let alumnos = [];
    let tareasSeleccionadas = [];
    let valoresTareas = {};
    let resultados = {};
    let criteriosPorTarea = {};

    // =========================================================================
    // === DATOS DE RÚBRICAS (desde RubricasTEC4Varios01.html) ===
    // =========================================================================

    const rubricasData = [
      {
        id: "c1",
        titulo: "TEC.4.1.1. Idear y planificar",
        descripcion: "Idear y planificar soluciones tecnológicas emprendedoras que generen un valor para la comunidad, a partir de la observación y el análisis del entorno más cercano, estudiando sus necesidades, requisitos y posibilidades de mejora.",
        competencia: 1,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>En su proyecto, no realiza ninguna observación documentada ni análisis de las necesidades del entorno.</li><li class='pl-2'>No presenta ninguna propuesta de solución tecnológica.</li><li class='pl-2'>No incluye un plan de acción ni lista de recursos necesarios.</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>En su proyecto, realiza observaciones y análisis del entorno, pero no están enfocadas en necesidades o requisitos relevantes.</li><li class='pl-2'>Sus propuestas de solución son poco viables.</li><li class='pl-2'>Sus propuestas de solución son básicas y necesitan más desarrollo.</li><li class='pl-2'>Su plan de acción es limitado, falta detalle y no identifica recursos necesarios.</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>En su proyecto, realiza observaciones y análisis adecuados del entorno.</li><li class='pl-2'>Propone soluciones tecnológicas viables, aunque pueden necesitar más refinamiento.</li><li class='pl-2'>Presenta un plan de acción básico, pero puede mejorar en detalle y organización.</li><li class='pl-2'>Identifica algunos recursos necesarios.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>En su proyecto, realiza observaciones y análisis exhaustivos del entorno.</li><li class='pl-2'>Sus propuestas de solución son creativas y bien desarrolladas.</li><li class='pl-2'>Su plan de acción es detallado y organizado, considerando la mayoría de los factores importantes.</li><li class='pl-2'>Identifica la mayoría de los recursos necesarios.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>En su proyecto, realiza observaciones y análisis exhaustivos, precisos y relevantes del entorno.</li><li class='pl-2'>Sus propuestas de solución son innovadoras, originales y muy bien desarrolladas.</li><li class='pl-2'>Su plan de acción es muy detallado, bien organizado, y considera todos los factores importantes y posibles contratiempos.</li><li class='pl-2'>Identifica todos los recursos necesarios.</li></ul>" }
        ]
      },
      {
        id: "c2",
        titulo: "TEC.4.1.2. Estrategias colaborativas",
        descripcion: "Aplicar con iniciativa estrategias colaborativas de gestión de proyectos con una perspectiva interdisciplinar y siguiendo un proceso iterativo de validación, desde la fase de ideación hasta la difusión de la solución.",
        competencia: 1,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>No participa activamente en el proyecto ni aporta ideas o soluciones.</li><li class='pl-2'>No se comunica ni coopera con el resto del equipo.</li><li class='pl-2'>No respeta las normas ni los plazos establecidos.</li><li class='pl-2'>No tiene en cuenta las aportaciones de otras disciplinas ni las necesidades del cliente o usuario.</li><li class='pl-2'>No revisa ni mejora su trabajo ni el del equipo.</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Participa poco en el proyecto y aporta ideas o soluciones poco originales o adecuadas.</li><li class='pl-2'>Se comunica y coopera poco con el resto del equipo.</li><li class='pl-2'>Respeta poco las normas y los plazos establecidos.</li><li class='pl-2'>Tiene poco en cuenta las aportaciones de otras disciplinas y las necesidades del cliente o usuario.</li><li class='pl-2'>Revisa y mejora poco su trabajo y el del equipo.</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Participa en el proyecto y aporta ideas o soluciones originales y adecuadas.</li><li class='pl-2'>Se comunica y coopera con el resto del equipo.</li><li class='pl-2'>Respeta las normas y los plazos establecidos.</li><li class='pl-2'>Tiene en cuenta las aportaciones de otras disciplinas y las necesidades del cliente o usuario.</li><li class='pl-2'>Revisa y mejora su trabajo y el del equipo.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Participa mucho en el proyecto y aporta ideas o soluciones muy originales y adecuadas.</li><li class='pl-2'>Se comunica y coopera mucho con el resto del equipo.</li><li class='pl-2'>Respeta mucho las normas y los plazos establecidos.</li><li class='pl-2'>Tiene muy en cuenta las aportaciones de otras disciplinas y las necesidades del cliente o usuario.</li><li class='pl-2'>Revisa y mejora mucho su trabajo y el del equipo.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Participa excelentemente en el proyecto y aporta ideas o soluciones excelentes y adecuadas.</li><li class='pl-2'>Se comunica y coopera excelentemente con el resto del equipo.</li><li class='pl-2'>Respeta excelentemente las normas y los plazos establecidos.</li><li class='pl-2'>Tiene excelentemente en cuenta las aportaciones de otras disciplinas y las necesidades del cliente o usuario.</li><li class='pl-2'>Revisa y mejora excelentemente su trabajo y el del equipo.</li></ul>" }
        ]
      },
      {
        id: "c3",
        titulo: "TEC.4.1.3. Gestión creativa de proyectos",
        descripcion: "Abordar la gestión del proyecto de forma creativa, aplicando estrategias y técnicas colaborativas adecuadas, así como métodos de investigación en la ideación de soluciones lo más eficientes, accesibles e innovadoras posibles.",
        competencia: 1,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>No muestra creatividad en la concepción o el diseño de su proyecto.</li><li class='pl-2'>Raramente participa en actividades grupales y no aporta al trabajo en equipo.</li><li class='pl-2'>No se observan esfuerzos de investigación para la mejora o la eficiencia del proyecto.</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Algunas ideas del proyecto muestran cierta creatividad, pero falta originalidad.</li><li class='pl-2'>Participa en actividades grupales, pero sus contribuciones son mínimas y no siempre aportan al equipo.</li><li class='pl-2'>Se observa una investigación superficial o poco detallada para su proyecto.</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Su proyecto muestra un pensamiento creativo básico y presenta algunas soluciones innovadoras.</li><li class='pl-2'>Colabora regularmente en actividades de grupo y contribuye de manera básica al trabajo en equipo.</li><li class='pl-2'>Realiza una investigación básica que ha permitido leves mejoras en su proyecto.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Su proyecto es notablemente creativo e incluye varias soluciones innovadoras.</li><li class='pl-2'>A menudo toma la iniciativa en actividades de grupo y su contribución mejora significativamente el rendimiento del equipo.</li><li class='pl-2'>Realiza investigaciones detalladas que conducen a soluciones más eficientes y accesibles en su proyecto.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Su proyecto es excepcionalmente creativo, presenta soluciones muy innovadoras que destacan de las demás.</li><li class='pl-2'>Constantemente impulsa y mejora el rendimiento del equipo con su fuerte liderazgo y habilidades colaborativas.</li><li class='pl-2'>Realiza investigaciones exhaustivas y profundas que han llevado a soluciones extremadamente eficientes, accesibles e innovadoras para su proyecto.</li></ul>" }
        ]
      },
      {
        id: "c4",
        titulo: "TEC.4.2.1. Analizar diseño y ciclo de vida",
        descripcion: "Analizar el diseño de un producto que dé respuesta a una necesidad planteada, evaluando su demanda, evolución y previsión de fin de ciclo de vida con un criterio ético, responsable e inclusivo.",
        competencia: 2,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>No analiza el diseño del producto ni identifica la necesidad que resuelve.</li><li class='pl-2'>No evalúa su demanda, evolución ni previsión de fin de ciclo de vida.</li><li class='pl-2'>No aplica un criterio ético, responsable e inclusivo</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Analiza superficialmente el diseño del producto y reconoce parcialmente la necesidad que resuelve.</li><li class='pl-2'>Evalúa de forma incompleta o inexacta su demanda, evolución y previsión de fin de ciclo de vida.</li><li class='pl-2'>Aplica un criterio ético, responsable e inclusivo de forma deficiente o inconsistente</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Analiza correctamente el diseño del producto y identifica la necesidad que resuelve.</li><li class='pl-2'>Evalúa adecuadamente su demanda, evolución y previsión de fin de ciclo de vida.</li><li class='pl-2'>Aplica un criterio ético, responsable e inclusivo de forma coherente y razonada.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Analiza detalladamente el diseño del producto y explica la necesidad que resuelve.</li><li class='pl-2'>Evalúa con precisión su demanda, evolución y previsión de fin de ciclo de vida.</li><li class='pl-2'>Aplica un criterio ético, responsable e inclusivo de forma rigurosa y argumentada.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Analiza exhaustivamente el diseño del producto y justifica la necesidad que resuelve.</li><li class='pl-2'>Evalúa con profundidad su demanda, evolución y previsión de fin de ciclo de vida.</li><li class='pl-2'>Aplica un criterio ético, responsable e inclusivo de forma excelente y crítica.</li></ul>" }
        ]
      },
      {
        id: "c5",
        titulo: "TEC.4.2.2. Fabricar productos",
        descripcion: "Fabricar productos y soluciones tecnológicas, aplicando herramientas de diseño asistido, técnicas de elaboración manual, mecánica y digital y utilizando los materiales y recursos adecuados.",
        competencia: 2,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>No logra producir un producto o solución tecnológica, o el resultado es inadecuado o inapropiado.</li><li class='pl-2'>No utiliza herramientas de diseño asistido de manera efectiva en la creación del producto.</li><li class='pl-2'>No utiliza adecuadamente técnicas manuales, mecánicas o digitales, y los materiales y recursos mecánicos, eléctricos, electrónicos y digitales seleccionados son inadecuados.</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Produce un producto o solución tecnológica, pero presenta fallos o es inadecuado para la necesidad prevista.</li><li class='pl-2'>Utiliza herramientas de diseño asistido, pero de manera muy limitada or ineficaz.</li><li class='pl-2'>Utiliza algunas técnicas manuales, mecánicas o digitales adecuadamente, y los materiales y recursos mecánicos, eléctricos, electrónicos y digitales utilizados son insuficientes y se podrían mejorar</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Produce un producto o solución tecnológica que cumple con la necesidad prevista.</li><li class='pl-2'>Utiliza herramientas de diseño asistido de manera efectiva en la creación del producto.</li><li class='pl-2'>Utiliza técnicas manuales, mecánicas y digitales adecuadamente, y los materiales y recursos mecánicos, eléctricos, electrónicos y digitales seleccionados son apropiados, pero admiten mejora.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Produce un producto o solución tecnológica que no solo cumple con la necesidad prevista, sino que muestra elementos de innovación o creatividad.</li><li class='pl-2'>Utiliza herramientas de diseño asistido de manera muy efectiva, y su uso mejora la calidad del producto final.</li><li class='pl-2'>Utiliza técnicas manuales, mecánicas y digitales con gran habilidad, y los materiales y recursos mecánicos, eléctricos, electrónicos y digitales seleccionados son óptimos y aumentan la calidad del producto final.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Produce un producto o solución tecnológica que es excepcional en términos de diseño, funcionalidad e innovación.</li><li class='pl-2'>Demuestra un uso maestro de las herramientas de diseño asistido, lo que mejora significativamente la calidad del producto final.</li><li class='pl-2'>Demuestra una gran maestría en el uso de técnicas manuales, mecánicas y digitales, y la selección y uso de materiales y recursos mecánicos, eléctricos, electrónicos y digitales son excepcionales, aportando a la funcionalidad y la innovación del producto final.</li></ul>" }
        ]
      },
      {
        id: "c6",
        titulo: "TEC.4.3.1. Intercambiar información",
        descripcion: "Intercambiar información y fomentar el trabajo en equipo de manera asertiva, empleando las herramientas digitales adecuadas junto con el vocabulario técnico, símbolos y esquemas de sistemas tecnológicos apropiados.",
        competencia: 3,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>No intercambia información ni fomenta el trabajo en equipo.</li><li class='pl-2'>No emplea las herramientas digitales adecuadas ni el vocabulario técnico, símbolos y esquemas de sistemas tecnológicos apropiados.</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Intercambia información y fomenta el trabajo en equipo de forma escasa o inadecuada.</li><li class='pl-2'>Emplea las herramientas digitales adecuadas y el vocabulario técnico, símbolos y esquemas de sistemas tecnológicos apropiados de forma deficiente o incompleta.</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Intercambia información y fomenta el trabajo en equipo de forma adecuada y asertiva.</li><li class='pl-2'>Emplea las herramientas digitales adecuadas y el vocabulario técnico, símbolos y esquemas de sistemas tecnológicos apropiados de forma correcta y completa.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Intercambia información y fomenta el trabajo en equipo de forma eficaz y asertiva.</li><li class='pl-2'>Emplea las herramientas digitales adecuadas y el vocabulario técnico, símbolos y esquemas de sistemas tecnológicos apropiados de forma óptima y precisa.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Intercambia información y fomenta el trabajo en equipo de forma excelente y asertiva.</li><li class='pl-2'>Emplea las herramientas digitales adecuadas y el vocabulario técnico, símbolos y esquemas de sistemas tecnológicos apropiados de forma excelente y creativa.</li></ul>" }
        ]
      },
      {
        id: "c7",
        titulo: "TEC.4.3.2. Presentar y difundir",
        descripcion: "Presentar y difundir las propuestas o soluciones tecnológicas de manera efectiva, empleando la entonación, expresión, gestión del tiempo y adaptación adecuada del discurso, así como un lenguaje inclusivo y no sexista.",
        competencia: 3,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>La presentación es confusa, desorganizada y no se ajusta al tiempo establecido.</li><li class='pl-2'>La entonación y la expresión son monótonas y no transmiten interés ni seguridad.</li><li class='pl-2'>El discurso es incoherente, irrelevante o incompleto.</li><li class='pl-2'>El lenguaje es excluyente y sexista.</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>La presentación es poco clara, poco estructurada y se desvía del tiempo establecido.</li><li class='pl-2'>La entonación y la expresión son poco variadas y transmiten poco interés o seguridad.</li><li class='pl-2'>El discurso es poco coherente, poco relevante o poco completo.</li><li class='pl-2'>El lenguaje es poco inclusivo y poco respetuoso con la diversidad.</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>La presentación es clara, estructurada y se ajusta aproximadamente al tiempo establecido.</li><li class='pl-2'>La entonación y la expresión son adecuadas y transmiten interés y seguridad.</li><li class='pl-2'>El discurso es coherente, relevante y completo.</li><li class='pl-2'>El lenguaje es inclusivo y respeta la diversidad.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>La presentación es muy clara, muy estructurada y se ajusta al tiempo establecido.</li><li class='pl-2'>La entonación y la expresión son variadas y transmiten mucho interés y seguridad.</li><li class='pl-2'>El discurso es muy coherente, muy relevante y muy completo.</li><li class='pl-2'>El lenguaje es muy inclusivo y muy respetuoso con la diversidad.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>La presentación es excelente, creativa y se ajusta al tiempo establecido con precisión.</li><li class='pl-2'>La entonación y la expresión son dinámicas y transmiten entusiasmo y confianza.</li><li class='pl-2'>El discurso es excelente, original y exhaustivo.</li><li class='pl-2'>El lenguaje es excelente, inclusivo y respetuoso con la diversidad en todo momento.</li></ul>" }
        ]
      },
      {
        id: "c8",
        titulo: "TEC.4.4.1. Diseñar sistemas automáticos",
        descripcion: "Diseñar, construir, controlar y simular sistemas automáticos programables y robots que sean capaces de realizar tareas de forma autónoma, aplicando conocimientos de mecánica, electrónica, neumática and componentes de los sistemas de control, así como otros conocimientos interdisciplinares.",
        competencia: 4,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>No realiza ni entrega los proyectos y/o prácticas de sistemas automáticos programables y robots o los hace con errores graves.</li><li class='pl-2'>No sabe qué son ni cómo funciona la mecánica y/o electrónica y/o neumática y/o los componentes de los sistemas de control.</li><li class='pl-2'>No relaciona los contenidos de tecnología con otras materias.</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Realiza y entrega los proyectos y/o prácticas de sistemas automáticos programables y robots con retraso o con errores significativos.</li><li class='pl-2'>Sabe qué son algunos elementos de la mecánica y/o electrónica y/o neumática y/o los componentes de los sistemas de control, pero no cómo funcionan.</li><li class='pl-2'>Relaciona los contenidos de tecnología con otras materias de forma superficial o incompleta.</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Realiza y entrega los proyectos y/o prácticas de sistemas automáticos programables y robots en el plazo establecido y con pocos errores.</li><li class='pl-2'>Sabe qué son y cómo funcionan los elementos básicos de la mecánica y/o electrónica y/o neumática y/o los componentes de los sistemas de control.</li><li class='pl-2'>Relaciona los contenidos de tecnología con otras materias de forma adecuada y coherente.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Realiza y entrega los proyectos y/o prácticas de sistemas automáticos programables y robots en el plazo establecido y sin errores.</li><li class='pl-2'>Sabe qué son y cómo funcionan varios elementos avanzados de la mecánica y/o electrónica y/o neumática y/o los componentes de los sistemas de control.</li><li class='pl-2'>Relaciona los contenidos de tecnología con otras materias de forma amplia y profunda.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Realiza y entrega los proyectos y/o prácticas de sistemas automáticos programables y robots en el plazo establecido y con un nivel superior al esperado.</li><li class='pl-2'>Sabe qué son y cómo funcionan diversos elementos innovadores o creativos de la mecánica y/o electrónica y/o neumática y/o los componentes de los sistemas de control.</li><li class='pl-2'>Relaciona los contenidos de tecnología con otras materias crítica y reflexivamente.</li></ul>" }
        ]
      },
      {
        id: "c9",
        titulo: "TEC.4.4.2. Integrar tecnologías emergentes",
        descripcion: "Integrar en las máquinas y sistemas tecnológicos aplicaciones informáticas y tecnologías digitales emergentes de control y simulación como el internet de las cosas, el big data y la inteligencia artificial con sentido crítico y ético.",
        competencia: 4,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>No identifica ni utiliza las aplicaciones informáticas y tecnologías digitales de control y simulación en las máquinas y sistemas tecnológicos.</li><li class='pl-2'>No realiza ningún intento por incorporar una aplicación de IoT, Big Data o IA en un proyecto y/o práctica, ni muestra interés por entender su uso ético y seguro.</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Identifica algunas aplicaciones informáticas y tecnologías digitales de control y simulación en las máquinas y sistemas tecnológicos, pero no las utiliza adecuadamente.</li><li class='pl-2'>Intenta incorporar una aplicación de IoT en un proyecto y/o práctica, pero no logra conectarla ni operar correctamente.</li><li class='pl-2'>Muestra una comprensión limitada del uso ético y seguro de estos dispositivos.</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Identifica y utiliza correctamente algunas aplicaciones informáticas y tecnologías digitales de control y simulación en las máquinas y sistemas tecnológicos.</li><li class='pl-2'>Configura e integra de modo muy básico una aplicación de IoT en un proyecto y/o práctica, demostrando un uso ético y seguro muy básico de la tecnología.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Identifica y utiliza correctamente y con autonomía varias aplicaciones informáticas y tecnologías digitales de control y simulación en las máquinas y sistemas tecnológicos.</li><li class='pl-2'>Configura e integra una aplicación de IoT y utiliza Big Data or IA en un proyecto o práctica más complejo/a, demostrando un uso ético y seguro avanzado de estas tecnologías.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Identifica y utiliza correctamente y con creatividad diversas aplicaciones informáticas y tecnologías digitales de control y simulación en las máquinas y sistemas tecnológicos.</li><li class='pl-2'>Configura e integra de manera innovadora y avanzada aplicaciones de IoT, Big Data e IA en un proyecto y/o práctica complejo/a y original, demostrando un alto nivel de uso ético y seguro de estas tecnologías.</li></ul>" }
        ]
      },
      {
        id: "c10",
        titulo: "TEC.4.5.1. Resolver tareas con herramientas digitales",
        descripcion: "Resolver tareas propuestas de manera eficiente mediante el uso y configuración de diferentes aplicaciones y herramientas digitales, aplicando conocimientos interdisciplinares con autonomía.",
        competencia: 5,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>No entrega las tareas o las hace con errores graves.</li><li class='pl-2'>No realiza ningún intento de uso de herramientas digitales para completar las tareas asignadas en clase.</li><li class='pl-2'>No se observa evidencia de trabajo o esfuerzo en las actividades asignadas.</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Entrega las tareas con retraso o con errores significativos.</li><li class='pl-2'>Intenta usar una herramienta digital para completar una tarea en clase pero necesita ayuda constante y su resultado final es incompleto.</li><li class='pl-2'>Se puede ver un intento en las actividades, aunque su aplicación de conocimientos es muy limitada</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Entrega las tareas en el plazo establecido y con pocos errores.</li><li class='pl-2'>Sabe usar y configurar las aplicaciones y herramientas digitales que se le indican, siguiendo instrucciones o ejemplos dados pero de modo básico.</li><li class='pl-2'>Relaciona los contenidos de tecnología con otras materias de forma básica.</li><li class='pl-2'>Trabaja por su cuenta cuando es necesario, pero no siempre.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Entrega las tareas en el plazo establecido y sin errores.</li><li class='pl-2'>Demuestra un uso eficiente y autónomo de diferentes herramientas digitales para completar tareas en clase y su aplicación interdisciplinaria de conocimientos es clara.</li><li class='pl-2'>Trabaja por su cuenta con iniciativa y responsabilidad.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Entrega las tareas en el plazo establecido y con un nivel superior al esperado.</li><li class='pl-2'>Utiliza de manera experta y creativa diversas herramientas digitales para resolver tareas de clase, aplicando conocimientos interdisciplinares de manera innovadora.</li><li class='pl-2'>Relaciona los contenidos de tecnología con otras materias de forma crítica y reflexiva.</li><li class='pl-2'>Trabaja por su cuenta con proactividad e independencia.</li></ul>" }
        ]
      },
      {
        id: "c11",
        titulo: "TEC.4.6.1. Uso responsable de la tecnología",
        descripcion: "Hacer un uso responsable de la tecnología, mediante el análisis y aplicación de criterios de sostenibilidad y accesibilidad en la selección de materiales y en el diseño de estos, así como en los procesos de fabricación de productos tecnológicos, minimizando el impacto negativo en la sociedad y en el planeta.",
        competencia: 6,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>No reconoce el concepto de sostenibilidad y accesibilidad y no puede identificar estos criterios en el uso de materiales o desarrollo de procesos tecnológicos.</li><li class='pl-2'>No respeta las normas de seguridad e higiene en el taller.</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Selecciona e identifica algunos materiales y procesos tecnológicos sostenibles y accesibles pero tiene dificultades para aplicar estos conceptos en su trabajo.</li><li class='pl-2'>Respeta las normas de seguridad e higiene en el taller solo cuando se le recuerda.</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Selecciona materiales sostenibles y accesibles para un proyecto o práctica simple.</li><li class='pl-2'>Además, muestra un entendimiento básico de cómo su proceso de trabajo pode minimizar el impacto negativo en la sociedad y el planeta.</li><li class='pl-2'>Respeta las normas de seguridad e higiene en el taller siempre que se le indica.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Selecciona e implementa materiales sostenibles y accesibles en un proyecto o práctica de mediana complejidad.</li><li class='pl-2'>Además, muestra un entendimiento avanzado de cómo su proceso de trabalho pode minimizar el impacto negativo en la sociedad y el planeta.</li><li class='pl-2'>Respeta las normas de seguridad e higiene en el taller con iniciativa y responsabilidad.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Selecciona, implementa y justifica el uso de materiales sostenibles y accesibles en un proyecto de alta complejidad o en una práctica avanzada.</li><li class='pl-2'>Demuestra constantemente cómo su proceso de trabajo minimiza el impacto negativo en la sociedad y el planeta, y hace propuestas para mejorar la sostenibilidad y accesibilidad en futuros proyectos.</li><li class='pl-2'>Respeta las normas de seguridad e higiene en el taller con proactividad e independencia.</li></ul>" }
        ]
      },
      {
        id: "c12",
        titulo: "TEC.4.6.2. Analizar arquitectura bioclimática",
        descripcion: "Analizar los beneficios que, en el cuidado del entorno, aportan la arquitectura bioclimática y el ecotransporte, valorando la contribución de las tecnologías al desarrollo sostenible.",
        competencia: 6,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>No muestra comprensión alguna de los conceptos de arquitectura bioclimática y ecotransporte, y no es capaz de identificar su relación con el cuidado del entorno y el desarrollo sostenible.</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Muestra una mínima comprensión de los conceptos de arquitectura bioclimática y ecotransporte, y sus beneficios para el cuidado del entorno, pero tiene dificultades para conectar estos conceptos con el desarrollo sostenible.</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Muestra una aceptable comprensión de los conceptos de arquitectura bioclimática y ecotransporte y es capaz de describir los beneficios de la arquitectura bioclimática y el ecotransporte para el cuidado del entorno.</li><li class='pl-2'>Muestra una comprensión básica de cómo estas tecnologías pueden contribuir al desarrollo sostenible.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Muestra una notable comprensión de los conceptos de arquitectura bioclimática y ecotransporte y es capaz de describir cómo influyen en el medio ambiente, dando ejemplos concretos o reales.</li><li class='pl-2'>Reconoce el papel de diversas tecnologías para mejorar la calidad de vida de las personas y el planeta, dando ejemplos concretos o reales.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Muestra una sobresaliente comprensión de los conceptos de arquitectura bioclimática y ecotransporte y cómo influyen en el medio ambiente, dando ejemplos originales o creativos.</li><li class='pl-2'>Reconoce el papel de diversas tecnologías para mejorar la calidad de vida de las personas y el planeta, dando ejemplos originales o creativos.</li></ul>" }
        ]
      },
      {
        id: "c13",
        titulo: "TEC.4.6.3. Valorar proyectos sociales",
        descripcion: "Identificar y valorar la repercusión y los beneficios del desarrollo de proyectos tecnológicos de carácter social, por medio de comunidades abiertas, acciones de voluntariado o proyectos de servicio a la comunidad.",
        competencia: 6,
        niveles: [
          { nivel: "(1-2.9)", color: "bg-red-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>No identifica ni valora la repercusión y los beneficios del desarrollo de proyectos tecnológicos de carácter social, por medio de comunidades abiertas, acciones de voluntariado o proyectos de servicio a la comunidad.</li><li class='pl-2'>Por ejemplo, no sabe qué son ni para qué sirven estos tipos de proyectos.</li><li class='pl-2'>No muestra interés ni participación en ellos.</li></ul>" },
          { nivel: "(3-4.9)", color: "bg-orange-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Identifica y valora parcialmente la repercusión y los beneficios del desarrollo de proyectos tecnológicos de carácter social, por medio de comunidades abiertas, acciones de voluntariado o proyectos de servicio a la comunidad.</li><li class='pl-2'>Por ejemplo, sabe qué son algunos de estos tipos de proyectos, pero no para qué sirven.</li><li class='pl-2'>Muestra poco interés y participación en ellos.</li></ul>" },
          { nivel: "(5-6.9)", color: "bg-yellow-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Identifica y valora correctamente la repercusión y los beneficios del desarrollo de proyectos tecnológicos de carácter social, por medio de comunidades abiertas, acciones de voluntariado o proyectos de servicio a la comunidad.</li><li class='pl-2'>Por ejemplo, sabe qué son y para qué sirven estos tipos de proyectos.</li><li class='pl-2'>Muestra interés y participación en ellos cuando se le indica.</li></ul>" },
          { nivel: "(7-8.9)", color: "bg-green-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Identifica y valora muy bien la repercusión y los beneficios del desarrollo de proyectos tecnológicos de carácter social, por medio de comunidades abiertas, actions de voluntariado o proyectos de servicio a la comunidad.</li><li class='pl-2'>Por ejemplo, sabe qué son y para qué sirven estos tipos de proyectos, dando ejemplos concretos o reales.</li><li class='pl-2'>Muestra interés y participación en ellos con iniciativa y responsabilidad.</li></ul>" },
          { nivel: "(9-10)", color: "bg-blue-50", descriptor: "<ul class='list-disc list-inside space-y-1'><li class='pl-2'>Identifica y valora excelentemente la repercusión y los beneficios del desarrollo de proyectos tecnológicos de carácter social, por medio de comunidades abiertas, acciones de voluntariado o proyectos de servicio a la comunidad.</li><li class='pl-2'>Por ejemplo, sabe qué son y para qué sirven estos tipos de proyectos, dando ejemplos originales o creativos.</li><li class='pl-2'>Muestra interés y participación en ellos con proactividad e independencia.</li></ul>" }
        ]
      }
    ];

    // =========================================================================
    // === FUNCIONES DE EXPORTACIÓN DE RÚBRICAS ===
    // =========================================================================

    /**
     * Limpia un string HTML y lo formatea para CSV, encerrándolo entre comillas.
     */
    function cleanDescriptor(htmlString) {
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = htmlString;
      const textoPlano = tempDiv.textContent || tempDiv.innerText || '';
      // Limpiar saltos de línea y espacios múltiples, y escapar comillas
      const textoLimpio = textoPlano.replace(/\s+/g, ' ').trim();
      return `"${textoLimpio.replace(/"/g, '""')}"`;
    }

    /**
     * Genera las líneas de puntos y descriptores según el formato seleccionado.
     */
    function getExportData(format, nivelesInvertidos) {
      let puntosLinea = "\t";
      let descriptoresLinea = "\t";

      // Extraer descriptores limpios (Alto a Bajo)
      const desc_10 = cleanDescriptor(nivelesInvertidos[0].descriptor); // (9-10)
      const desc_8_9 = cleanDescriptor(nivelesInvertidos[1].descriptor); // (7-8.9)
      const desc_5_6 = cleanDescriptor(nivelesInvertidos[2].descriptor); // (5-6.9)
      const desc_3_4 = cleanDescriptor(nivelesInvertidos[3].descriptor); // (3-4.9)
      const desc_1_2 = cleanDescriptor(nivelesInvertidos[4].descriptor); // (1-2.9)
      const desc_0 = `"No entregado"`;

      switch(String(format)) {
        case '1': // 1) 10, 8, 6, 4, 2 (5 niveles)
          puntosLinea += "10.0\t8.0\t6.0\t4.0\t2.0";
          descriptoresLinea += `${desc_10}\t${desc_8_9}\t${desc_5_6}\t${desc_3_4}\t${desc_1_2}`;
          break;
        case '2': // 2) 10, 8, 6, 4, 2, 0 (6 niveles)
          puntosLinea += "10.0\t8.0\t6.0\t4.0\t2.0\t0.0";
          descriptoresLinea += `${desc_10}\t${desc_8_9}\t${desc_5_6}\t${desc_3_4}\t${desc_1_2}\t${desc_0}`;
          break;
        case '3': // 3) 10, 8.5, 7.5, 6.5, 5.5, 4.5, 3.5, 2.5, 1.5 (9 niveles)
          puntosLinea += "10.0\t8.5\t7.5\t6.5\t5.5\t4.5\t3.5\t2.5\t1.5";
          descriptoresLinea += `${desc_10}\t${desc_8_9}\t${desc_8_9}\t${desc_5_6}\t${desc_5_6}\t${desc_3_4}\t${desc_3_4}\t${desc_1_2}\t${desc_1_2}`;
          break;
        case '4': // 4) 10, 8.5, 7.5 ... 1.5, 0 (10 niveles)
          puntosLinea += "10.0\t8.5\t7.5\t6.5\t5.5\t4.5\t3.5\t2.5\t1.5\t0.0";
          descriptoresLinea += `${desc_10}\t${desc_8_9}\t${desc_8_9}\t${desc_5_6}\t${desc_5_6}\t${desc_3_4}\t${desc_3_4}\t${desc_1_2}\t${desc_1_2}\t${desc_0}`;
          break;
        default: // Fallback a la opción 1
          puntosLinea += "10.0\t8.0\t6.0\t4.0\t2.0";
          descriptoresLinea += `${desc_10}\t${desc_8_9}\t${desc_5_6}\t${desc_3_4}\t${desc_1_2}`;
      }
      
      return { puntosLinea, descriptoresLinea };
    }

    /**
     * Convierte el título completo en un formato abreviado para la exportación.
     * Corregido: Ahora mantiene los puntos en los códigos (TEC.4.1.1. en lugar de TEC4 1 1)
     * y elimina los paréntesis, poniendo la primera letra en mayúsculas
     */
    function getTituloAbreviado(tituloCompleto) {
      // Extraer el código (TEC.4.1.1.)
      const codigoMatch = tituloCompleto.match(/^(TEC\.\d+\.\d+\.\d+)\./);
      if (!codigoMatch) return tituloCompleto;
      
      // Mantener el código con puntos (TEC.4.1.1.)
      const codigo = codigoMatch[1] + ".";
      
      // Extraer la parte descriptiva y crear un título abreviado
      let descripcionAbreviada = tituloCompleto.replace(/^TEC\.\d+\.\d+\.\d+\.\s*/, '');
      
      // Crear abreviaciones comunes
      const abreviaciones = {
        'Intercambiar información': 'Intercambio información',
        'Presentar y difundir': 'Presentación en público',
        'Idear y planificar': 'Ideación y planificación',
        'Estrategias colaborativas': 'Trabajo colaborativo',
        'Gestión creativa de proyectos': 'Gestión de proyectos',
        'Analizar diseño y ciclo de vida': 'Análisis de diseño',
        'Fabricar productos': 'Fabricación de productos',
        'Diseñar sistemas automáticos': 'Sistemas automáticos',
        'Integrar tecnologías emergentes': 'Tecnologías emergentes',
        'Resolver tareas': 'Resolución de tareas',
        'Uso responsable': 'Sostenibilidad',
        'Analizar arquitectura bioclimática': 'Arquitectura bioclimática',
        'Valorar proyectos sociales': 'Proyectos sociales'
      };
      
      // Aplicar abreviación si existe
      for (const [completo, abreviado] of Object.entries(abreviaciones)) {
        if (descripcionAbreviada.includes(completo)) {
          descripcionAbreviada = abreviado;
          break;
        }
      }
      
      // Asegurar que la primera letra es mayúscula
      descripcionAbreviada = descripcionAbreviada.charAt(0).toUpperCase() + descripcionAbreviada.slice(1);
      
      return `${codigo} ${descripcionAbreviada}`;
    }

    /**
     * Exporta las rúbricas de los criterios utilizados en la evaluación actual a CSV.
     */
    function exportarRubricasCSV() {
      // Recopilar criterios únicos utilizados en la evaluación
      const criteriosUtilizados = new Set();
      tareasSeleccionadas.forEach(tarea => {
        criteriosPorTarea[tarea].forEach(criterio => {
          criteriosUtilizados.add(criterio);
        });
      });

      // Buscar las rúbricas correspondientes
      const rubricasParaExportar = rubricasData.filter(rubrica => {
        // Extraer el código del criterio del título de la rúbrica
        // Convertir TEC.4.1.1. a TEC4.1.1 para comparar
        const codigoRubrica = rubrica.titulo.split(' ')[0].replace('TEC.', 'TEC').replace(/\.$/, '');
        return criteriosUtilizados.has(codigoRubrica);
      });

      if (rubricasParaExportar.length === 0) {
        alert("No se encontraron rúbricas para los criterios utilizados en esta evaluación.");
        return;
      }

      // Usar formato por defecto (opción 1)
      const format = '1';
      
      // Generar CSV
      let csvRows = [
        "Se recomienda no editar las guías de evaluación en formato de hoja de cálculo",
        "v1.0-s"
      ];

      rubricasParaExportar.forEach(criterio => {
        const tituloAbreviado = getTituloAbreviado(criterio.titulo);
        csvRows.push(tituloAbreviado);
        csvRows.push(criterio.descripcion);
        
        const nivelesInvertidos = [...criterio.niveles].reverse();
        const { puntosLinea, descriptoresLinea } = getExportData(format, nivelesInvertidos);
        
        csvRows.push(puntosLinea);
        csvRows.push(descriptoresLinea);
        csvRows.push("");
      });

      // Crear y descargar archivo
      const csvString = csvRows.join('\n');
      const BOM = '\uFEFF'; // Byte Order Mark para UTF-8
      const blob = new Blob([BOM + csvString], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      
      const actividad = document.getElementById('actividad').value || "Evaluacion";
      link.setAttribute('download', `rubricas_${actividad.replace(/ /g, '_')}.csv`);
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);

      setTimeout(() => {
        alert(`Se han exportado ${rubricasParaExportar.length} rúbrica(s) en formato CSV.\n\nPara importar a Google Classroom:\n\n1. Abre una Google Sheet en blanco\n2. Importa este archivo CSV\n3. Renombra la hoja (ej: "Rúbrica para importar")\n4. Importa desde Google Classroom`);
      }, 500);
    }

    // =========================================================================
    // === FUNCIONES DE EXPORTACIÓN/IMPORTACIÓN DE ALUMNADO ===
    // =========================================================================

    /**
     * Exporta el alumnado actual a un archivo JSON
     */
    function exportarAlumnado() {
      const nombreClase = document.getElementById('nombre-clase').value.trim() || 'Clase';
      const actividad = document.getElementById('actividad').value.trim() || 'Actividad';
      
      // Verificar que hay alumnos guardados
      if (alumnos.length === 0) {
        alert("No hay alumnos guardados para exportar.");
        return;
      }
      
      const datos = {
        clase: nombreClase,
        actividad: actividad,
        fechaExportacion: new Date().toISOString(),
        alumnos: alumnos
      };
      
      const datosStr = JSON.stringify(datos, null, 2);
      const blob = new Blob([datosStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `Actividades_${nombreClase}_Alumnado.json`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
      
      alert(`Alumnado de la clase ${nombreClase} exportado correctamente.`);
    }

    /**
     * Importa alumnado desde un archivo JSON
     */
    function importarAlumnado(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const datos = JSON.parse(e.target.result);
          
          // Validar la estructura del archivo
          if (!datos.clase || !Array.isArray(datos.alumnos)) {
            throw new Error('El archivo no tiene el formato correcto.');
          }
          
          // Actualizar el nombre de la clase
          document.getElementById('nombre-clase').value = datos.clase;
          
          // Actualizar el nombre de la actividad si está presente
          if (datos.actividad) {
            document.getElementById('actividad').value = datos.actividad;
          }
          
          // Actualizar el número de alumnos
          document.getElementById('num-alumnos').value = datos.alumnos.length;
          
          // Actualizar la lista de alumnos
          alumnos = datos.alumnos;
          
          // Actualizar la interfaz
          actualizarInterfazAlumnos();
          
          alert(`Alumnado de la clase ${datos.clase} importado correctamente. Se han cargado ${datos.alumnos.length} alumnos.`);
          
          // Limpiar el input de archivo
          event.target.value = '';
          
        } catch (error) {
          alert('Error al importar el archivo: ' + error.message);
        }
      };
      reader.readAsText(file);
    }

    /**
     * Actualiza la interfaz con los alumnos importados
     */
    function actualizarInterfazAlumnos() {
      const alumnosContainer = document.getElementById('alumnos-container');
      alumnosContainer.innerHTML = '';
      
      alumnos.forEach((alumno, index) => {
        const alumnoItem = document.createElement('div');
        alumnoItem.className = 'alumno-item';
        alumnoItem.innerHTML = `
          <div class="alumno-header">
            <label>Alumno ${index + 1}</label>
          </div>
          <input type="text" class="alumno-input" value="${alumno}" placeholder="Nombre completo">
        `;
        alumnosContainer.appendChild(alumnoItem);
      });
      
      // Mostrar la sección de nombres de alumnos
      document.getElementById('nombres-alumnos-section').style.display = 'block';
    }

    // =========================================================================
    // === FUNCIONES DE AYUDA - MODAL ===
    // =========================================================================

    function mostrarAyuda() {
      document.getElementById('help-modal').style.display = 'flex';
    }

    function ocultarAyuda() {
      document.getElementById('help-modal').style.display = 'none';
    }

    // =========================================================================
    // === FUNCIONES PRINCIPALES DE LA APLICACIÓN ===
    // =========================================================================

    // Función para ajustar posición de tooltips
    function ajustarTooltips() {
      document.querySelectorAll('[data-tooltip]').forEach(element => {
        const rect = element.getBoundingClientRect();
        const tooltipWidth = 250; // Ancho estimado del tooltip
        
        // Si el elemento está cerca del borde izquierdo
        if (rect.left < tooltipWidth / 2) {
          element.classList.add('tooltip-left');
          element.classList.remove('tooltip-right');
        } 
        // Si el elemento está cerca del borde derecho
        else if (window.innerWidth - rect.right < tooltipWidth / 2) {
          element.classList.add('tooltip-right');
          element.classList.remove('tooltip-left');
        } 
        // En el centro
        else {
          element.classList.remove('tooltip-left', 'tooltip-right');
        }
      });
    }

    function validarNumeroPositivo(input, min = 0, max = null) {
      let value = parseFloat(input.value);
      
      if (isNaN(value)) {
        input.value = min;
        input.classList.add('invalid');
        setTimeout(() => input.classList.remove('invalid'), 1000);
        return min;
      }
      
      if (value < min) {
        input.value = min;
        input.classList.add('invalid');
        setTimeout(() => input.classList.remove('invalid'), 1000);
        return min;
      }
      
      if (max !== null && value > max) {
        input.value = max;
        input.classList.add('invalid');
        setTimeout(() => input.classList.remove('invalid'), 1000);
        return max;
      }
      
      return value;
    }

    function inicializarTareas() {
      const selectorDiv = document.getElementById("selector-tareas");
      selectorDiv.innerHTML = '';
      
      Object.keys(tareasCriterios).forEach(tarea => {
        criteriosPorTarea[tarea] = [...tareasCriterios[tarea]];
      });
      
      Object.keys(tareasCriterios).forEach(tarea => {
        const item = document.createElement("div");
        item.className = "tarea-item";
        
        // Quitamos el data-tooltip del label
        item.innerHTML = `
          <div class="tarea-header">
            <label>
              <input type="checkbox" class="tarea-checkbox" value="${tarea}"> 
              ${tarea}
            </label>
            <input type="number" min="1" value="10" class="valor-input" 
                   data-tarea="${tarea}" placeholder="Valor">
          </div>
          <div class="tarea-criteria">
            <h4>
              Criterios de evaluación 
              <i class="fas fa-chevron-down"></i>
            </h4>
            <div class="criterios-list" id="criterios-${tarea}"></div>
          </div>
        `;
        selectorDiv.appendChild(item);
        
        const valorInput = item.querySelector('.valor-input');
        valorInput.addEventListener('input', function() {
          validarNumeroPositivo(this, 1);
        });
        
        const criteriosContainer = document.getElementById(`criterios-${tarea}`);
        criterios.forEach(criterio => {
          const isChecked = criteriosPorTarea[tarea].includes(criterio);
          const criterioItem = document.createElement("div");
          criterioItem.className = "criterio-item";
          criterioItem.innerHTML = `
            <input type="checkbox" id="criterio-${tarea}-${criterio}" 
                   value="${criterio}" ${isChecked ? 'checked' : ''}
                   data-tarea="${tarea}">
            <label for="criterio-${tarea}-${criterio}" 
                   data-tooltip="${tooltipTextos[criterio] || 'Descripción no disponible'}">${criterio}</label>
          `;
          criteriosContainer.appendChild(criterioItem);
        });
        
        const toggleIcon = item.querySelector('.tarea-criteria h4 i');
        const criteriosList = item.querySelector('.criterios-list');
        item.querySelector('.tarea-criteria h4').addEventListener('click', () => {
          if (criteriosList.style.display === 'none' || !criteriosList.style.display) {
            criteriosList.style.display = 'grid';
            toggleIcon.classList.add('rotated');
          } else {
            criteriosList.style.display = 'none';
            toggleIcon.classList.remove('rotated');
          }
          // Reajustar tooltips después de mostrar/ocultar
          setTimeout(ajustarTooltips, 50);
        });
      });
      
      document.querySelectorAll('.criterio-item input').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const tarea = this.getAttribute('data-tarea');
          const criterio = this.value;
          
          if (this.checked) {
            if (!criteriosPorTarea[tarea].includes(criterio)) {
              criteriosPorTarea[tarea].push(criterio);
            }
          } else {
            criteriosPorTarea[tarea] = criteriosPorTarea[tarea].filter(c => c !== criterio);
          }
        });
      });
      
      // Ajustar tooltips después de cargar
      setTimeout(ajustarTooltips, 100);
    }

    function generarFormularioAlumnos() {
      const numAlumnosInput = document.getElementById('num-alumnos');
      let numAlumnos = parseInt(numAlumnosInput.value);
      
      // Validar y corregir el número de alumnos
      if (isNaN(numAlumnos)) {
        numAlumnos = 5;
        numAlumnosInput.value = 5;
      } else if (numAlumnos < 1) {
        numAlumnos = 1;
        numAlumnosInput.value = 1;
      } else if (numAlumnos > 50) {
        numAlumnos = 50;
        numAlumnosInput.value = 50;
      }
      
      const alumnosContainer = document.getElementById('alumnos-container');
      alumnosContainer.innerHTML = '';
      
      // Si ya tenemos alumnos guardados, los usamos, sino creamos nuevos
      for (let i = 0; i < numAlumnos; i++) {
        const alumnoItem = document.createElement('div');
        alumnoItem.className = 'alumno-item';
        
        // Usar el nombre guardado si existe, sino campo vacío
        const nombreGuardado = alumnos[i] || '';
        
        alumnoItem.innerHTML = `
          <div class="alumno-header">
            <label>Alumno ${i + 1}</label>
          </div>
          <input type="text" class="alumno-input" value="${nombreGuardado}" placeholder="Nombre completo">
        `;
        alumnosContainer.appendChild(alumnoItem);
      }
      
      document.getElementById('nombres-alumnos-section').style.display = 'block';
      document.getElementById('nombres-alumnos-section').scrollIntoView({ behavior: 'smooth' });
    }

    function guardarAlumnos() {
      const inputsAlumnos = document.querySelectorAll('.alumno-input');
      alumnos = []; // Reiniciamos el array
      let todosLlenos = true;
      let nombresVacios = [];
      
      inputsAlumnos.forEach((input, index) => {
        const nombre = input.value.trim();
        
        if (nombre === '') {
          nombresVacios.push(index + 1);
          todosLlenos = false;
        } else {
          alumnos.push(nombre);
        }
      });
      
      if (!todosLlenos) {
        if (nombresVacios.length > 0) {
          alert(`Por favor, ingrese el nombre para los siguientes alumnos: ${nombresVacios.join(', ')}`);
        }
        return;
      }
      
      alert(`Nombres de ${alumnos.length} alumnos guardados correctamente`);
      // No ocultamos la sección para permitir la exportación
      // document.getElementById('nombres-alumnos-section').style.display = 'none';
    }

    function generarEvaluacion() {
      tareasSeleccionadas = [];
      valoresTareas = {};
      
      document.querySelectorAll('.tarea-checkbox:checked').forEach(cb => {
        const tarea = cb.value;
        tareasSeleccionadas.push(tarea);
        const valorInput = document.querySelector(`.valor-input[data-tarea="${tarea}"]`);
        valoresTareas[tarea] = validarNumeroPositivo(valorInput, 1);
      });
      
      if (tareasSeleccionadas.length === 0) {
        alert("Por favor, seleccione al menos una tarea.");
        return;
      }
      
      if (alumnos.length === 0) {
        alert("Por favor, configure primero los alumnos.");
        return;
      }
      
      document.getElementById('evaluacion-section').style.display = 'block';
      document.getElementById('resultados-section').style.display = 'none';
      
      const tablaHeader = document.getElementById('tabla-header');
      tablaHeader.innerHTML = '<th>Tarea</th><th class="max-value-cell">Valor Máx</th>';
      
      alumnos.forEach(alumno => {
        tablaHeader.innerHTML += `<th class="student-header-cell">${alumno}</th>`;
      });
      
      const cuerpoTabla = document.getElementById('cuerpo-tabla');
      cuerpoTabla.innerHTML = '';
      
      tareasSeleccionadas.forEach(tarea => {
        const fila = document.createElement('tr');
        const maxValor = valoresTareas[tarea];
        
        // Obtener descripciones de criterios para el tooltip
        const criteriosDesc = criteriosPorTarea[tarea].map(c => {
          return `${c}: ${tooltipTextos[c] || 'Sin descripción'}`;
        }).join('\n');
        
        fila.innerHTML = `
          <td class="criteria-cell" data-tooltip="${criteriosDesc}">
            ${tarea}
          </td>
          <td class="max-value-cell">${maxValor}</td>
        `;
        
        alumnos.forEach(() => {
          fila.innerHTML += `
            <td>
              <input type="number" min="0" max="${maxValor}" value="0" class="student-score" 
                     data-tarea="${tarea}" placeholder="Punt">
            </td>
          `;
        });
        
        cuerpoTabla.appendChild(fila);
      });
      
      const scoreInputs = document.querySelectorAll('.student-score');
      scoreInputs.forEach(input => {
        input.addEventListener('input', function() {
          const max = parseFloat(this.getAttribute('max'));
          validarNumeroPositivo(this, 0, max);
        });
      });
      
      // Ajustar tooltips después de generar la tabla
      setTimeout(ajustarTooltips, 100);
      document.getElementById('evaluacion-section').scrollIntoView({ behavior: 'smooth' });
    }

    function calcularResultados() {
      resultados = {};
      
      const criteriosEvaluados = new Set();
      tareasSeleccionadas.forEach(tarea => {
        criteriosPorTarea[tarea].forEach(criterio => {
          criteriosEvaluados.add(criterio);
        });
      });
      
      alumnos.forEach((alumno, alumnoIndex) => {
        resultados[alumno] = {
          tareas: {},
          criterios: {},
          promedio: 0
        };
        
        tareasSeleccionadas.forEach(tarea => {
          const inputs = document.querySelectorAll(`.student-score[data-tarea="${tarea}"]`);
          const input = inputs[alumnoIndex];
          const maxValor = valoresTareas[tarea];
          const value = validarNumeroPositivo(input, 0, maxValor);
          
          resultados[alumno].tareas[tarea] = value;
        });
        
        Array.from(criteriosEvaluados).forEach(criterio => {
          let sumaPuntuacion = 0;
          let sumaMaximo = 0;
          
          tareasSeleccionadas.forEach(tarea => {
            if (criteriosPorTarea[tarea].includes(criterio)) {
              sumaPuntuacion += resultados[alumno].tareas[tarea];
              sumaMaximo += valoresTareas[tarea];
            }
          });
          
          resultados[alumno].criterios[criterio] = sumaMaximo > 0 ? 
            (sumaPuntuacion / sumaMaximo) * 10 : 0;
        });
        
        const valores = Object.values(resultados[alumno].criterios);
        const suma = valores.reduce((acc, val) => acc + val, 0);
        resultados[alumno].promedio = valores.length > 0 ? suma / valores.length : 0;
      });
      
      mostrarResultados();
    }

    function mostrarResultados() {
      const resumenDiv = document.getElementById('resumen-alumnos');
      resumenDiv.innerHTML = '';
      
      alumnos.forEach(alumno => {
        const card = document.createElement('div');
        card.className = 'student-card';
        
        const promedio = resultados[alumno].promedio;
        let colorClass = '';
        if (promedio < 5) colorClass = 'text-danger';
        else if (promedio < 7) colorClass = 'text-warning';
        else colorClass = 'text-success';
        
        const series = {};
        Object.keys(resultados[alumno].criterios).forEach(criterio => {
          const serie = criterio.substring(0, 6);
          if (!series[serie]) series[serie] = [];
          series[serie].push(criterio);
        });
        
        let criteriosHTML = '';
        
        const familiasOrden = [
          "TEC4.1", "TEC4.2", "TEC4.3", 
          "TEC4.4", "TEC4.5", "TEC4.6"
        ];
        
        familiasOrden.forEach(familia => {
          if (series[familia]) {
            criteriosHTML += `<div class="criteria-group">${familia} - ${getSerieDescription(familia)}</div>`;
            
            series[familia].sort().forEach(criterio => {
              const descripcion = tooltipTextos[criterio] || 'Sin descripción disponible';
              criteriosHTML += `
                <div class="criteria-row">
                  <div class="criteria-name" data-tooltip="${descripcion}">${criterio}</div>
                  <div class="criteria-score">${resultados[alumno].criterios[criterio].toFixed(2)}</div>
                </div>
              `;
            });
          }
        });
        
        card.innerHTML = `
          <div class="student-header">
            <div class="student-name">${alumno}</div>
            <div class="student-avg ${colorClass}">${promedio.toFixed(2)}</div>
          </div>
          
          <div class="criteria-container">
            ${criteriosHTML}
          </div>
        `;
        
        resumenDiv.appendChild(card);
      });
      
      // Ajustar tooltips en los resultados
      setTimeout(ajustarTooltips, 100);
      document.getElementById('resultados-section').style.display = 'block';
      document.getElementById('resultados-section').scrollIntoView({ behavior: 'smooth' });
    }

    function getSerieDescription(serie) {
      const descriptions = {
        "TEC4.1": "Gestión de Proyectos",
        "TEC4.2": "Diseño y Fabricación",
        "TEC4.3": "Comunicación",
        "TEC4.4": "Sistemas Automáticos",
        "TEC4.5": "Resolución Digital",
        "TEC4.6": "Sostenibilidad"
      };
      return descriptions[serie] || "Área Tecnológica";
    }
    
    function exportarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      const actividad = document.getElementById('actividad').value || "Evaluación";
      const fecha = new Date().toLocaleDateString();
      
      let firstStudent = true;
      let yPos = 20;
      
      // Encabezado solo para la primera página
      doc.setFontSize(20);
      doc.text(`Resultados de Evaluación: ${actividad}`, 15, yPos);
      yPos += 10;
      
      doc.setFontSize(12);
      doc.setTextColor(100);
      doc.text(`Fecha: ${fecha}`, 15, yPos);
      yPos += 20;
      
      alumnos.forEach((alumno, index) => {
        // Nueva página para cada alumno (excepto el primero)
        if (!firstStudent) {
          doc.addPage();
          yPos = 20; // Reiniciar posición en nueva página
        } else {
          firstStudent = false;
        }
        
        // Datos del alumno
        doc.setFontSize(16);
        doc.setTextColor(0);
        doc.text(`Alumno: ${alumno}`, 15, yPos);
        
        doc.setFontSize(14);
        doc.text(`Promedio: ${resultados[alumno].promedio.toFixed(2)}`, 15, yPos + 10);
        yPos += 25;
        
        // Cabecera de criterios
        doc.setFontSize(12);
        doc.setTextColor(100);
        doc.text("Criterio", 15, yPos);
        doc.text("Nota", 180, yPos, { align: 'right' });
        yPos += 8;
        doc.line(15, yPos, 195, yPos);
        yPos += 10;
        
        doc.setFontSize(11);
        doc.setTextColor(0);
        
        // Agrupación de criterios por familia
        const series = {};
        Object.keys(resultados[alumno].criterios).forEach(criterio => {
          const serie = criterio.substring(0, 6);
          if (!series[serie]) series[serie] = [];
          series[serie].push(criterio);
        });
        
        const familiasOrden = ["TEC4.1", "TEC4.2", "TEC4.3", "TEC4.4", "TEC4.5", "TEC4.6"];
        
        familiasOrden.forEach(familia => {
          if (series[familia]) {
            // Verificar espacio antes de agregar nueva familia
            if (yPos > 280) {
              doc.addPage();
              yPos = 20;
            }
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            doc.text(`${familia} - ${getSerieDescription(familia)}`, 15, yPos);
            doc.setFont(undefined, 'normal');
            yPos += 8;
            
            series[familia].sort().forEach(criterio => {
              // Verificar espacio antes de agregar criterio
              if (yPos > 280) {
                doc.addPage();
                yPos = 20;
              }
              
              doc.text(criterio, 20, yPos);
              doc.text(resultados[alumno].criterios[criterio].toFixed(2), 180, yPos, { align: 'right' });
              yPos += 10;
            });
            
            yPos += 5; // Espacio entre familias
          }
        });
        
        yPos += 10; // Espacio final para el próximo alumno
      });
      
      doc.save(`evaluacion-${actividad.replace(/ /g, '_')}.pdf`);
    }

    // =========================================================================
    // === FUNCIONALIDAD DE SECCIONES COLAPSABLES ===
    // =========================================================================

    function inicializarSeccionesColapsables() {
      const secciones = [
        { id: 'nombres-alumnos', defaultState: 'collapsed' },
        { id: 'tareas', defaultState: 'expanded' },
        { id: 'evaluacion', defaultState: 'collapsed' },
        { id: 'resultados', defaultState: 'collapsed' }
      ];
      
      secciones.forEach(seccion => {
        const title = document.getElementById(`${seccion.id}-title`);
        const content = document.getElementById(`${seccion.id}-content`);
        
        if (title && content) {
          // Establecer estado inicial
          if (seccion.defaultState === 'collapsed') {
            title.classList.add('collapsed');
            content.classList.remove('expanded');
            content.classList.add('collapsed');
          } else {
            title.classList.remove('collapsed');
            content.classList.remove('collapsed');
            content.classList.add('expanded');
          }
          
          // Añadir event listener
          title.addEventListener('click', () => {
            title.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
            content.classList.toggle('expanded');
          });
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      inicializarTareas();
      inicializarSeccionesColapsables();
      
      // Ajustar tooltips cuando cambia el tamaño de la ventana
      window.addEventListener('resize', ajustarTooltips);
      
      // Configurar eventos de ayuda
      document.getElementById('help-button').addEventListener('click', mostrarAyuda);
      document.getElementById('close-modal').addEventListener('click', ocultarAyuda);
      document.getElementById('help-modal').addEventListener('click', function(e) {
        if (e.target === this) {
          ocultarAyuda();
        }
      });
      
      // Configurar eventos principales
      document.getElementById('seleccionar-todas').addEventListener('click', () => {
        document.querySelectorAll('.tarea-checkbox').forEach(cb => cb.checked = true);
      });
      
      document.getElementById('deseleccionar-todas').addEventListener('click', () => {
        document.querySelectorAll('.tarea-checkbox').forEach(cb => cb.checked = false);
      });
      
      document.getElementById('configurar-alumnos').addEventListener('click', generarFormularioAlumnos);
      document.getElementById('guardar-alumnos').addEventListener('click', guardarAlumnos);
      document.getElementById('generar-evaluacion').addEventListener('click', generarEvaluacion);
      document.getElementById('calcular-resultados').addEventListener('click', calcularResultados);
      
      // Configurar eventos de exportación/importación de alumnado
      document.getElementById('exportar-alumnos').addEventListener('click', exportarAlumnado);
      document.getElementById('importar-alumnos').addEventListener('click', () => {
        document.getElementById('importar-alumnos-file').click();
      });
      document.getElementById('importar-alumnos-file').addEventListener('change', importarAlumnado);
      
      document.getElementById('nueva-evaluacion').addEventListener('click', () => {
        document.getElementById('evaluacion-section').style.display = 'none';
        document.getElementById('resultados-section').style.display = 'none';
        document.querySelector('.config-section').scrollIntoView({ behavior: 'smooth' });
      });
      
      document.getElementById('volver-evaluacion').addEventListener('click', () => {
        document.getElementById('resultados-section').style.display = 'none';
        document.getElementById('evaluacion-section').style.display = 'block';
        document.getElementById('evaluacion-section').scrollIntoView({ behavior: 'smooth' });
      });
      
      document.getElementById('exportar-pdf').addEventListener('click', exportarPDF);
      
      // Añadir event listener para los botones de exportar rúbricas
      document.getElementById('exportar-rubricas-csv').addEventListener('click', exportarRubricasCSV);
      document.getElementById('exportar-rubricas-csv-tareas').addEventListener('click', exportarRubricasCSV);
      
      // Validación para valor total de actividad
      document.getElementById('valor-total').addEventListener('input', function() {
        validarNumeroPositivo(this, 1);
      });
      
      // Validación para número de alumnos
      document.getElementById('num-alumnos').addEventListener('input', function() {
        validarNumeroPositivo(this, 1, 50);
      });
    });
  </script>
</body>
</html>